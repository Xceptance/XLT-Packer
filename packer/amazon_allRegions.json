{
  "variables": {
    "xlt-version" : "LATEST",
    "image_name" : "XLT-Image-{{timestamp}}",

    "aws_access_key": "<YOUR_AWS_ACCESS_KEY>",
    "aws_secret_key": "<YOUR_AWS_SECRET_KEY>",

    "ssh_keypair_name_ap_northeast_1": "<SSH_KEY_PAIR_NAME>",
    "ssh_private_key_file_ap_northeast_1": "<PATH_TO_SSH_PRIVATE_KEY>",
    "ssh_keypair_name_ap_southeast_1": "<SSH_KEY_PAIR_NAME>",
    "ssh_private_key_file_ap_southeast_1": "<PATH_TO_SSH_PRIVATE_KEY>",
    "ssh_keypair_name_ap_southeast_2": "<SSH_KEY_PAIR_NAME>",
    "ssh_private_key_file_ap_southeast_2": "<PATH_TO_SSH_PRIVATE_KEY>",
    "ssh_keypair_name_eu_central_1": "<SSH_KEY_PAIR_NAME>",
    "ssh_private_key_file_eu_central_1": "<PATH_TO_SSH_PRIVATE_KEY>",
    "ssh_keypair_name_eu_west_1": "<SSH_KEY_PAIR_NAME>",
    "ssh_private_key_file_eu_west_1": "<PATH_TO_SSH_PRIVATE_KEY>",
    "ssh_keypair_name_sa_east_1": "<SSH_KEY_PAIR_NAME>",
    "ssh_private_key_file_sa_east_1": "<PATH_TO_SSH_PRIVATE_KEY>",
    "ssh_keypair_name_us_east_1": "<SSH_KEY_PAIR_NAME>",
    "ssh_private_key_file_us_east_1": "<PATH_TO_SSH_PRIVATE_KEY>",
    "ssh_keypair_name_us_west_1": "<SSH_KEY_PAIR_NAME>",
    "ssh_private_key_file_us_west_1" : "<PATH_TO_SSH_PRIVATE_KEY>",
    "ssh_keypair_name_us_west_2": "<SSH_KEY_PAIR_NAME>",
    "ssh_private_key_file_us_west_2": "<PATH_TO_SSH_PRIVATE_KEY>"
  },
  "builders": [
  {
    "name": "ap-northeast-1",
    "type": "amazon-ebs",
    "access_key": "{{user `aws_access_key`}}",
    "secret_key": "{{user `aws_secret_key`}}",
    "region": "ap-northeast-1",
    "source_ami": "ami-925cff92",
    "instance_type": "t1.micro",
    "ssh_username": "ubuntu",
    "ami_name": "{{user `image_name`}}",
    "ssh_keypair_name": "{{user `ssh_keypair_name_ap_northeast_1`}}",
    "ssh_private_key_file": "{{user `ssh_private_key_file_ap_northeast_1`}}"
  },
  {
    "name": "ap-southeast-1",
    "type": "amazon-ebs",
    "access_key": "{{user `aws_access_key`}}",
    "secret_key": "{{user `aws_secret_key`}}",
    "region": "ap-southeast-1",
    "source_ami": "ami-e27879b0",
    "instance_type": "t1.micro",
    "ssh_username": "ubuntu",
    "ami_name": "{{user `image_name`}}",
    "ssh_keypair_name": "{{user `ssh_keypair_name_ap_southeast_1`}}",
    "ssh_private_key_file": "{{user `ssh_private_key_file_ap_southeast_1`}}"
  },
  {
    "name": "ap-southeast-2",
    "type": "amazon-ebs",
    "access_key": "{{user `aws_access_key`}}",
    "secret_key": "{{user `aws_secret_key`}}",
    "region": "ap-southeast-2",
    "source_ami": "ami-3dce8b07",
    "instance_type": "t1.micro",
    "ssh_username": "ubuntu",
    "ami_name": "{{user `image_name`}}",
    "ssh_keypair_name": "{{user `ssh_keypair_name_ap_southeast_2`}}",
    "ssh_private_key_file": "{{user `ssh_private_key_file_ap_southeast_2`}}"
  },
  {
    "name": "eu-central-1",
    "type": "amazon-ebs",
    "access_key": "{{user `aws_access_key`}}",
    "secret_key": "{{user `aws_secret_key`}}",
    "region": "eu-central-1",
    "source_ami": "ami-6ef9c273",
    "instance_type": "m3.medium",
    "ssh_username": "ubuntu",
    "ami_name": "{{user `image_name`}}",
    "ssh_keypair_name": "{{user `ssh_keypair_name_eu_central_1`}}",
    "ssh_private_key_file": "{{user `ssh_private_key_file_eu_central_1`}}"
  },
  {
    "name": "eu-west-1",
    "type": "amazon-ebs",
    "access_key": "{{user `aws_access_key`}}",
    "secret_key": "{{user `aws_secret_key`}}",
    "region": "eu-west-1",
    "source_ami": "ami-8a4809fd",
    "instance_type": "t1.micro",
    "ssh_username": "ubuntu",
    "ami_name": "{{user `image_name`}}",
    "ssh_keypair_name": "{{user `ssh_keypair_name_eu_west_1`}}",
    "ssh_private_key_file": "{{user `ssh_private_key_file_eu_west_1`}}"
  },
  {
    "name": "sa-east-1",
    "type": "amazon-ebs",
    "access_key": "{{user `aws_access_key`}}",
    "secret_key": "{{user `aws_secret_key`}}",
    "region": "sa-east-1",
    "source_ami": "ami-d99518c4",
    "instance_type": "t1.micro",
    "ssh_username": "ubuntu",
    "ami_name": "{{user `image_name`}}",
    "ssh_keypair_name": "{{user `ssh_keypair_name_sa_east_1`}}",
    "ssh_private_key_file": "{{user `ssh_private_key_file_sa_east_1`}}"
  },
  {
    "name": "us-east-1",
    "type": "amazon-ebs",
    "access_key": "{{user `aws_access_key`}}",
    "secret_key": "{{user `aws_secret_key`}}",
    "region": "us-east-1",
    "source_ami": "ami-fb35f390",
    "instance_type": "t1.micro",
    "ssh_username": "ubuntu",
    "ami_name": "{{user `image_name`}}",
    "ssh_keypair_name": "{{user `ssh_keypair_name_us_east_1`}}",
    "ssh_private_key_file": "{{user `ssh_private_key_file_us_east_1`}}"
  },
  {
    "name": "us-west-1",
    "type": "amazon-ebs",
    "access_key": "{{user `aws_access_key`}}",
    "secret_key": "{{user `aws_secret_key`}}",
    "region": "us-west-1",
    "source_ami": "ami-af3dcceb",
    "instance_type": "t1.micro",
    "ssh_username": "ubuntu",
    "ami_name": "{{user `image_name`}}",
    "ssh_keypair_name": "{{user `ssh_keypair_name_us_west_1`}}",
    "ssh_private_key_file": "{{user `ssh_private_key_file_us_west_1`}}"
  },
  {
    "name": "us-west-2",
    "type": "amazon-ebs",
    "access_key": "{{user `aws_access_key`}}",
    "secret_key": "{{user `aws_secret_key`}}",
    "region": "us-west-2",
    "source_ami": "ami-975b5da7",
    "instance_type": "t1.micro",
    "ssh_username": "ubuntu",
    "ami_name": "{{user `image_name`}}",
    "ssh_keypair_name": "{{user `ssh_keypair_name_us_west_2`}}",
    "ssh_private_key_file": "{{user `ssh_private_key_file_us_west_2`}}"
  }
  ],
   "provisioners": [
   {
    "type": "shell",
      "inline": [
      "mkdir ~/xlt-home",
      "mkdir ~/init.d"
    ]
  },
  {
    "type": "file",
    "source": "./scripts/init.d/ipv6tunnel",
    "destination": "~/init.d/ipv6tunnel"
  },
  {
    "type": "file",
    "source": "./scripts/init.d/mountdev",
    "destination": "~/init.d/mountdev"
  },
  {
    "type": "file",
    "source": "./scripts/init.d/ntptime",
    "destination": "~/init.d/ntptime"
  },
  {
    "type": "file",
    "source": "./scripts/init.d/userdata",
    "destination": "~/init.d/userdata"
  },
  {
    "type": "file",
    "source": "./scripts/init.d/xlt",
    "destination": "~/init.d/xlt"
  },
  {
    "type": "file",
    "source": "./scripts/xlt-home/getUserData.sh",
    "destination": "~/xlt-home/getUserData.sh"
  },
  {
    "type": "file",
    "source": "./scripts/xlt-home/prepare-image-creation.sh",
    "destination": "~/xlt-home/prepare-image-creation.sh"
  },
  {
    "type": "file",
    "source": "./scripts/xlt-home/setup-image.sh",
    "destination": "~/xlt-home/setup-image.sh"
  },
  {
    "type": "file",
    "source": "./scripts/xlt-home/start-xlt.sh",
    "destination": "~/xlt-home/start-xlt.sh"
  },
  {
    "type": "file",
    "source": "./scripts/xlt-home/update-xlt.sh",
    "destination": "~/xlt-home/update-xlt.sh"
  },
  {
    "type": "shell",
      "inline": [
      "sleep 30",
      "sudo chmod +x ~/xlt-home/*.sh",
      "sudo chmod +x ~/init.d/*",
      "sudo -E -S ~/xlt-home/setup-image.sh  {{user `xlt-version`}}"
    ]
  }]
}